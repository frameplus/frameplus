# Frame Plus ERP 종합 점검 리포트

## FramePlus v8-4.jsx vs 현재 코드베이스 (v7) 비교 분석

**작성일**: 2026-02-19  
**분석 대상**:  
- `FramePlus_v8-4.jsx` (업로드 파일 — 이전 대화에서 분석 완료, 약 286KB)  
- 현재 코드베이스: `src/index.tsx` (1,176줄) + `public/static/app.js` (4,987줄) = **총 6,163줄**

---

## 1. 아키텍처 비교

| 항목 | v8-4.jsx (참조파일) | 현재 코드베이스 (v7) | 평가 |
|------|---------------------|---------------------|------|
| **파일 구조** | 단일 JSX 파일 (서버+클라이언트 통합) | `index.tsx` (서버) + `app.js` (클라이언트) 분리 | ✅ 현재가 우수 — 관심사 분리 |
| **서버 프레임워크** | Hono + Cloudflare Workers | Hono + Cloudflare Workers | 동등 |
| **데이터베이스** | D1 (20개 테이블) | D1 (20개 테이블) | 동등 — 동일 테이블 스키마 |
| **CRUD 패턴** | Generic CRUD helper | Generic CRUD helper | 동등 |
| **CSS 디자인** | v6 스타일 (다크/라이트, 기본 반응형) | v7 Pluuug-Inspired SaaS 디자인 | ✅ 현재가 우수 — 모던 디자인 |
| **다크모드** | 있음 (CSS 변수 기반) | 있음 (CSS 변수 기반, 확장 호환) | ✅ 현재가 우수 — 역호환 별칭 포함 |
| **모바일 대응** | 기본 반응형 | 완전 반응형 + 모바일 하단 네비게이션 | ✅ 현재가 우수 |
| **라우팅** | Browser history 기반 SPA | Browser history 기반 SPA | 동등 |

---

## 2. 기능별 상세 비교

### 2.1 서버사이드 (index.tsx)

| 기능 | v8-4 | 현재 v7 | 상태 |
|------|------|---------|------|
| Auto-migrate (테이블 자동 생성) | ✅ | ✅ | 동등 |
| Generic CRUD (20 테이블) | ✅ | ✅ | 동등 |
| Company singleton | ✅ | ✅ | 동등 |
| Bulk seed (초기 데이터) | ✅ | ✅ | 동등 |
| Health check | ✅ | ✅ | 동등 |
| Notification read/mark-all | ✅ | ✅ | 동등 |
| PriceDB stats (단가 통계) | ✅ | ✅ | 동등 |
| Approval workflow (승인/반려) | ✅ | ✅ | 동등 |
| Dashboard stats (cost flow) | ✅ | ✅ | 동등 |
| Weather proxy (현재/예보) | ✅ | ✅ | 동등 |
| Spellcheck (OpenAI) | ✅ | ✅ | 동등 |
| AI Document assist | ✅ | ✅ | 동등 |
| Email (일반/견적서) | ✅ | ✅ | 동등 |
| **발주서 전용 이메일 API** | ❌ 없음 | ✅ 프론트엔드에서 `/api/email/send`로 직접 호출 | ✅ 현재가 우수 |

> **서버사이드 결론**: 두 파일의 서버 로직은 사실상 동일합니다. 차이는 v7에서 일부 개선된 에러 핸들링과 코드 정리 수준입니다.

### 2.2 클라이언트사이드 (app.js)

| 기능 | v8-4 | 현재 v7 | 상태 |
|------|------|---------|------|
| **API 레이어** | ✅ `api()` + 에러 처리 | ✅ `api()` + 에러 처리 | 동등 |
| **Optimistic UI** | ✅ `optimistic()` | ✅ `optimistic()` | 동등 |
| **데이터 캐시** | ✅ `_d` 인메모리 | ✅ `_d` 인메모리 | 동등 |
| **다크모드** | ✅ | ✅ | 동등 |
| **알림 시스템** | ✅ 알림 드롭다운 + 센터 | ✅ 알림 드롭다운 + 센터 | 동등 |
| **결재 워크플로우** | ✅ | ✅ | 동등 |
| **대시보드** | ✅ (v6 스타일) | ✅ (Pluuug SaaS 스타일) | ✅ 현재가 우수 — KPI 카드, Cost Flow |
| **프로젝트 목록** | ✅ 기본 테이블 | ✅ + 월별 그룹 + 정렬 | ✅ 현재가 우수 |
| **견적 작성** | ✅ 공종별 접기/펴기 + 프리셋 | ✅ 공종별 접기/펴기 + 프리셋 | 동등 |
| **견적 프리뷰/인쇄** | ✅ | ✅ | 동등 |
| **공정표(Gantt)** | ✅ | ✅ | 동등 |
| **발주 관리** | ✅ 기본 리스트 | ✅ 리스트 + 상세 + 이메일 발송 | ✅ 현재가 우수 |
| **수금 관리** | ✅ | ✅ | 동등 |
| **계약서** | ✅ | ✅ | 동등 |
| **인건비/노무비** | ✅ | ✅ + 월별 그룹 | ✅ 현재가 우수 |
| **지출결의서** | ✅ | ✅ | 동등 |
| **미팅 캘린더** | ✅ | ✅ | 동등 |
| **CRM** | ✅ | ✅ | 동등 |
| **단가 DB** | ✅ | ✅ | 동등 |
| **거래처** | ✅ | ✅ | 동등 |
| **세금계산서** | ✅ | ✅ | 동등 |
| **AS/하자보수** | ✅ | ✅ | 동등 |
| **팀원 관리** | ✅ | ✅ | 동등 |
| **리포트** | ✅ | ✅ | 동등 |
| **관리자** | ✅ | ✅ | 동등 |
| **날씨 위젯** | ✅ 현재 + 5일 예보 | ✅ 현재 + 5일 예보 | 동등 |
| **월별 그룹핑** | ✅ 기본 | ✅ `groupByMonth` + `monthlyAccordion` | ✅ 현재가 우수 |
| **필터바** | ✅ 기본 | ✅ 범용 `filterBar()` 유틸 | ✅ 현재가 우수 |

---

## 3. 핵심 문제점 및 누락사항

### 🔴 Critical (반드시 수정)

#### 3.1 프리셋 메뉴: 연도/월 → 프로젝트 계층 구조 미흡

**현재 상태**:
- `groupByMonth()` → `monthlyAccordion()` 함수가 존재하여 **월별 그룹핑**은 가능
- **프로젝트, 발주, 수금, 세금계산서, AS** 등에서 "월별 그룹" 토글 체크박스 제공
- 그러나 **연도 > 월 > 프로젝트 ID** 형태의 **트리 계층 프리셋 메뉴**는 **미구현**

**문제점**:
```
현재:   [월별 그룹 체크] → 2026년 2월 (3건) / 2026년 1월 (5건)
필요:   연도 선택 → 월 선택 → 프로젝트 선택 (드릴다운 네비게이션)
```

- 사이드바에 **연도/월/프로젝트** 트리 형태 네비게이션 없음
- 각 메뉴에서 **프로젝트별 드릴다운 필터링** 부족 (텍스트 검색만 가능)
- 발주, 노무비, 지출결의서 등에서 **프로젝트 > 월 > 항목** 형태의 계층 뷰 없음

**개선안**:
1. 사이드바에 **프로젝트 트리** 메뉴 추가: `연도(2026) > 월(2월) > 프로젝트명`
2. 각 데이터 페이지(발주, 노무비, 지출 등)에 **프로젝트 선택 필터 드롭다운** 추가
3. `groupByMonth()`를 확장하여 `groupByYearMonthProject()` 3단계 계층 생성
4. 대시보드에 **연도/월 선택기** 추가하여 해당 기간 KPI만 표시

#### 3.2 발주서 양식 및 전송 기능 부족

**현재 상태**:
- ✅ 발주서 생성 (`openNewOrder()`) — 프로젝트/공종/거래처/품목 입력
- ✅ 발주서 상세 편집 (`renderOrderDetail()`) — 품목 추가/수정/삭제
- ✅ 이메일 발송 (`sendOrderMail()` → `doSendOrderMail()`) — 기본 HTML 이메일
- ❌ **정식 발주서 양식(표준 포맷)** 미구현
- ❌ **발주서 PDF 생성** 미구현
- ❌ **발주서 인쇄 전용 레이아웃** 미구현 (현재 `printPage()`는 전체 화면 인쇄)
- ❌ 발주서 이메일에 **품목 상세 테이블** 미포함 (현재 요약만 발송)
- ❌ **발주서 템플릿** 저장/관리 기능 없음

**문제점 상세**:
```javascript
// 현재 발주서 이메일 HTML (doSendOrderMail 함수 내)
// 기본 정보만 포함 — 품목 리스트 누락
<table>
  <tr><td>현장명</td><td>${p?.nm}</td></tr>
  <tr><td>공종</td><td>${catNm(o.cid)}</td></tr>
  <tr><td>발주금액</td><td>₩${fmt(o.amount)}</td></tr>
  <tr><td>납기일</td><td>${o.deliv_date||'협의'}</td></tr>
  <tr><td>담당자</td><td>${o.assignee||co.ceo}</td></tr>
</table>
// 👆 품목별 품명, 규격, 수량, 단가, 금액이 빠져있음!
```

**개선안**:
1. 견적서 프리뷰(`renderEstPreview`)와 동일한 수준의 **발주서 프리뷰** 화면 구현
2. 발주서 이메일에 **품목 상세 테이블** 포함
3. `html2pdf.js` 활용한 **발주서 PDF 다운로드** 기능
4. 발주서 **인쇄 전용 CSS** (`@media print`)
5. 회사 정보(사업자번호, 도장 등)를 포함한 **공식 발주서 포맷**

#### 3.3 `updateOrder()` 함수의 `getData()` 호출 버그

```javascript
// 2339행 — 존재하지 않는 함수 호출
function updateOrder(field,val){
  const orders=getData('orders_manual',[]); // ❌ getData는 정의되지 않은 함수!
  // ... 이하 코드
}
```

**문제**: `getData()`는 현재 코드베이스에 정의되어 있지 않습니다. 이전 localStorage 기반 코드의 잔재로, D1 API 기반으로 마이그레이션이 누락된 부분입니다.

**해결**: `getData()` 대신 `getOrders()` 또는 `_d.orders` 사용으로 수정 필요

#### 3.4 `deleteOrder()` 함수의 동일 버그

```javascript
// 2425행
function deleteOrder(oid){
  if(!confirm('삭제하시겠습니까?'))return;
  const orders=getData('orders_manual',[]).filter(x=>x.id!==oid); // ❌ getData 미정의
  saveOrderManual(orders); // ❌ saveOrderManual 미정의
  nav('orders');toast('삭제되었습니다');
}
```

**문제**: `getData()`, `saveOrderManual()` 모두 미정의 함수입니다.

#### 3.5 `monthlyAccordion` 함수 중복 정의

```
4098행: function monthlyAccordion(groups, renderRow, extraHeader=''){...}
4788행: function monthlyAccordion(groups, renderRowFn, headerHtml){...}
```

**문제**: 동일 함수가 두 번 정의되어 두 번째 정의가 첫 번째를 덮어씁니다. 파라미터명이 다르고 내부 로직이 다를 수 있어 예기치 않은 동작을 유발할 수 있습니다.

---

### 🟡 Important (우선 개선)

#### 3.6 발주서에서 견적 항목 자동 연동 부족

**현재**: 발주서 생성 시 품목을 수동 입력
**필요**: 견적서의 공종별 항목을 자동으로 발주서에 import하는 기능

#### 3.7 프로젝트 필터 드롭다운 일관성 부족

**현재**: 발주, 노무비, 지출결의서 등에서 프로젝트 선택이 통일되지 않음
- 발주: 모달에서 `<select>` 프로젝트 선택
- 노무비: 모달에서 `<select>` 프로젝트 선택
- 리스트 뷰에서는 **프로젝트 필터 드롭다운 없음** (텍스트 검색만)

**필요**: 모든 리스트 뷰에 **프로젝트 셀렉트 필터** 공통 추가

#### 3.8 견적서 → 발주서 → 수금 → 세금계산서 워크플로우 단절

- 견적서에서 발주서를 직접 생성하는 **자동화 워크플로우** 없음
- 발주서 완료 시 세금계산서 자동 생성 연동 없음
- 수금 기록과 세금계산서 발행 간 연결 부족

#### 3.9 엑셀 내보내기 기능 불완전

```javascript
function exportXLSX(type){
  if(typeof XLSX==='undefined'){toast('Excel 라이브러리 로딩중...','warning');return;}
  // ... 각 type별 분기
}
```
- XLSX CDN은 로드하고 있으나, 일부 export 함수에서 **컬럼 매핑**이 하드코딩되어 있고
- **import(업로드)** 기능은 "SheetJS 필요" 경고만 표시

#### 3.10 리포트 페이지 기능 미완성

`renderReports()`가 기본 통계만 표시하며, **프로젝트별 수익성 분석**, **월별 매출 추이**, **비용 대비 수익 차트** 등이 부족합니다.

---

### 🟢 Minor (향후 개선)

| # | 항목 | 현재 상태 | 개선안 |
|---|------|-----------|--------|
| 3.11 | 사진/이미지 관리 | Base64 인라인 저장 | R2 Storage 활용 권장 |
| 3.12 | 날씨 위젯 | 서울 하드코딩 기본값 | 프로젝트 현장 위치 기반 자동 설정 |
| 3.13 | CRM 이력 추적 | 기본 리스트만 | 타임라인 뷰, 상호작용 로그 필요 |
| 3.14 | 검색 고도화 | 텍스트 검색만 | 복합 필터 (금액 범위, 기간, 상태 AND/OR) |
| 3.15 | 사용자 권한 | 단일 관리자 | 역할별 접근 제어 (관리자/매니저/현장) |
| 3.16 | 데이터 백업/복구 | 없음 | D1 백업 API 또는 export/import |
| 3.17 | 다국어 지원 | 한국어 고정 | i18n 프레임워크 도입 가능성 |
| 3.18 | PWA 지원 | 없음 | Service Worker + 오프라인 캐시 |

---

## 4. 메뉴별 기능 체크리스트

### ✅ 정상 동작 확인 (문제 없음)
- 대시보드 (KPI, Cost Flow, 날씨, 차트)
- 프로젝트 목록 (CRUD, 필터, 월별 그룹)
- 견적 작성 (공종별 편집, 프리셋, 프리뷰, 이메일)
- 공정표 (Gantt, 진행률)
- 수금 관리 (입금처리, KPI)
- 계약서 (문서 편집, 특약)
- 미팅 캘린더 (캘린더 뷰, CRUD)
- CRM (고객 리스트)
- 단가 DB (그룹핑, CRUD)
- 거래처 (CRUD, 평점)
- AS/하자보수 (CRUD, 필터)
- 팀원 관리 (CRUD)
- 알림 센터 (읽음 처리)
- 결재함 (승인/반려)
- 관리자 (공지, 회사정보)

### ⚠️ 부분 동작 (수정 필요)
| 메뉴 | 문제 | 심각도 |
|------|------|--------|
| **발주 작성** | `updateOrder()`, `deleteOrder()` 함수에서 미정의 함수 호출 | 🔴 Critical |
| **발주 작성** | 이메일 발송 시 품목 상세 누락 | 🟡 Important |
| **노무비** | 월별 그룹핑 동작하나, 프로젝트 필터 드롭다운 없음 | 🟡 Important |
| **지출결의서** | `renderExpenseDetail()` 함수 정의 누락 가능성 (grep 미발견) | 🟡 확인 필요 |
| **세금계산서** | 프로젝트 연동 검증 필요 | 🟢 Minor |
| **리포트** | 기본 통계만 — 차트/그래프 부족 | 🟡 Important |

---

## 5. 프리셋 메뉴 구조 개선안

### 5.1 현재 구조
```
사이드바:
├─ 대시보드
├─ 프로젝트 목록 → [전체 리스트 + 월별 그룹 토글]
├─ 견적 작성    → [프로젝트 선택 → 편집]
├─ 발주 작성    → [전체 리스트 + 월별 그룹 토글]
├─ 노무비       → [전체 리스트 + 월별 그룹]
└─ ...
```

### 5.2 개선 목표 구조
```
사이드바:
├─ 대시보드 (전체 현황)
├─ [연도/분기/월 필터] ← 상단 글로벌 필터 추가
├─ 프로젝트
│   ├─ 전체 프로젝트
│   ├─ 2026년
│   │   ├─ 2월 (3건)
│   │   │   ├─ ○○빌딩 인테리어
│   │   │   ├─ △△사무실 리모델링
│   │   │   └─ □□카페 신축
│   │   └─ 1월 (2건)
│   └─ 2025년
├─ 견적서 → [프로젝트별 자동 분류]
├─ 발주서 → [프로젝트별 자동 분류]
├─ 노무비 → [프로젝트별 자동 분류]
└─ ...

각 데이터 페이지:
┌─────────────────────────────────────┐
│ [2026▼] [2월▼] [프로젝트: 전체▼]   │ ← 3단계 필터 드롭다운
│ [상태: 전체▼] [검색어...]          │
├─────────────────────────────────────┤
│ 📁 ○○빌딩 인테리어 (3건)          │ ← 프로젝트별 아코디언
│   └─ 발주#1, 발주#2, 발주#3       │
│ 📁 △△사무실 리모델링 (1건)        │
│   └─ 발주#4                        │
└─────────────────────────────────────┘
```

### 5.3 구현 방안

1. **글로벌 날짜 필터** (topbar에 연도/월 선택기)
2. **filterBar 확장**: 프로젝트 선택 드롭다운 추가
3. **groupByYearMonthProject()** 3단계 그룹핑 함수 생성
4. **사이드바 트리뷰**: 프로젝트 섹션에 연도/월/프로젝트 트리 추가

---

## 6. 발주서 개선안

### 6.1 발주서 양식 (정식 포맷)
```
┌────────────────────────────────────────┐
│            [회사 로고]                  │
│          발   주   서                  │
│                                        │
│  발주처: (주)프레임플러스              │
│  사업자번호: XXX-XX-XXXXX             │
│  대표: 김승환                          │
│  주소: ...                             │
│                                        │
│  수주처: ○○건재(주)                   │
│  현장명: △△빌딩 인테리어              │
│  발주일: 2026-02-19                    │
│  납품일: 2026-02-25                    │
├────────────────────────────────────────┤
│ No | 품명  | 규격  | 단위 | 수량 | 단가 | 금액  │
│ 1  | LED조명| 600x600| EA | 50  | 15000| 750000│
│ 2  | 석고보드| 9.5T  | 매 | 200 | 3500 | 700000│
│ ...                                    │
├────────────────────────────────────────┤
│ 공급가액: 1,450,000원                  │
│ 부가세:     145,000원                  │
│ 합계:    1,595,000원                   │
├────────────────────────────────────────┤
│ 비고: ...                              │
│ 담당자: 김승환 (인)                    │
│                                        │
│       [PDF 다운로드] [이메일 발송]      │
└────────────────────────────────────────┘
```

### 6.2 발주서 이메일 개선

현재 이메일에 누락된 정보:
- ❌ 품목별 상세 테이블 (품명, 규격, 수량, 단가, 금액)
- ❌ 공급가액/부가세/합계 계산
- ❌ 회사 도장/서명
- ❌ 발주 조건 (결제 조건, 운송 조건 등)

### 6.3 워크플로우 자동화

```
견적서 승인 → [발주서 자동 생성 제안]
                  ↓
          발주서 편집 → 이메일 발송 → 업체 확인
                  ↓
          납품 완료 → 세금계산서 연동
                  ↓
          지급 처리 → 수금 관리 반영
```

---

## 7. 액션 아이템 (우선순위 순)

### Phase 1: 긴급 수정 (즉시)
| # | 항목 | 복잡도 | 영향도 |
|---|------|--------|--------|
| 1 | `updateOrder()` 내 `getData()` → `getOrders()` 수정 | 낮음 | 🔴 높음 |
| 2 | `deleteOrder()` 내 `getData()`/`saveOrderManual()` 수정 | 낮음 | 🔴 높음 |
| 3 | `monthlyAccordion()` 중복 정의 제거 | 낮음 | 🟡 중간 |

### Phase 2: 발주서 강화 (1-2일)
| # | 항목 | 복잡도 | 영향도 |
|---|------|--------|--------|
| 4 | 발주서 프리뷰 화면 (정식 양식 포맷) | 중간 | 🔴 높음 |
| 5 | 발주서 이메일에 품목 상세 테이블 포함 | 중간 | 🔴 높음 |
| 6 | 발주서 PDF 다운로드 (html2pdf.js 활용) | 중간 | 🟡 중간 |
| 7 | 발주서 인쇄 전용 레이아웃 | 낮음 | 🟡 중간 |
| 8 | 견적서 항목 → 발주서 자동 import | 중간 | 🟡 중간 |

### Phase 3: 프리셋 메뉴 구조화 (2-3일)
| # | 항목 | 복잡도 | 영향도 |
|---|------|--------|--------|
| 9 | `filterBar()` 확장: 프로젝트 선택 드롭다운 추가 | 낮음 | 🔴 높음 |
| 10 | `groupByYearMonthProject()` 3단계 그룹핑 함수 | 중간 | 🟡 중간 |
| 11 | 글로벌 날짜 필터 (topbar 연도/월 선택기) | 중간 | 🟡 중간 |
| 12 | 사이드바 프로젝트 트리뷰 | 높음 | 🟢 낮음 |

### Phase 4: 워크플로우 연동 (3-5일)
| # | 항목 | 복잡도 | 영향도 |
|---|------|--------|--------|
| 13 | 견적 → 발주 → 세금계산서 자동 연동 | 높음 | 🟡 중간 |
| 14 | 리포트 페이지 고도화 (차트, 프로젝트별 수익성) | 중간 | 🟡 중간 |
| 15 | 엑셀 import 기능 완성 | 중간 | 🟢 낮음 |

### Phase 5: 고도화 (향후)
| # | 항목 | 복잡도 | 영향도 |
|---|------|--------|--------|
| 16 | 사용자 권한 시스템 | 높음 | 🟡 중간 |
| 17 | R2 Storage 기반 이미지 관리 | 중간 | 🟢 낮음 |
| 18 | PWA 오프라인 지원 | 중간 | 🟢 낮음 |
| 19 | 데이터 백업/복구 기능 | 중간 | 🟡 중간 |
| 20 | AI 기반 견적 자동 산출 고도화 | 높음 | 🟡 중간 |

---

## 8. 종합 평가

### 점수 (10점 만점)

| 분류 | 점수 | 코멘트 |
|------|------|--------|
| **아키텍처** | 8/10 | 서버/클라이언트 분리, 깔끔한 CRUD 패턴, 단일 파일 프론트엔드의 한계 |
| **디자인/UI** | 8.5/10 | v7 Pluuug 리디자인 우수, 다크모드/반응형 완성도 높음 |
| **기능 완성도** | 7/10 | 핵심 CRUD는 동작하나 워크플로우 자동화, 프리셋 계층 부족 |
| **데이터 무결성** | 6.5/10 | 미정의 함수 호출 버그, 함수 중복 정의 문제 존재 |
| **확장성** | 7.5/10 | Generic CRUD 패턴 확장 용이, 테이블 추가 간편 |
| **사용자 경험** | 7/10 | 기본 동선은 좋으나 프로젝트별 드릴다운/필터링 부족 |
| **종합** | **7.4/10** | 안정적인 기반 위에 워크플로우/발주서/프리셋 강화가 핵심 과제 |

### 결론

현재 코드베이스(v7)는 v8-4.jsx 대비 **디자인, 필터링, 발주서 이메일** 측면에서 더 발전되어 있으나, 다음 3가지가 가장 시급한 개선 과제입니다:

1. **🔴 버그 수정**: `updateOrder()`, `deleteOrder()` 내 미정의 함수 호출 → 발주 편집/삭제가 깨짐
2. **🔴 발주서 양식 완성**: 정식 발주서 포맷, 품목 상세 포함 이메일, PDF 다운로드
3. **🔴 프리셋 메뉴**: 연도/월 → 프로젝트 계층 네비게이션 + 각 페이지 프로젝트 필터

이 3가지를 Phase 1-3로 처리하면 **실무 사용 가능한 ERP**로 완성도가 크게 올라갑니다.
